[gd_scene load_steps=28 format=3 uid="uid://c3kdff65tnyxu"]

[ext_resource type="Script" uid="uid://cas1vuvfuctsr" path="res://game/rollercoaster/rollercoaster.gd" id="1_fpfh7"]
[ext_resource type="Shader" uid="uid://coelylstno2qo" path="res://game/shaders/squash_and_stretch.gdshader" id="2_y8uoc"]
[ext_resource type="Script" uid="uid://c03h3xluod86s" path="res://game/state_machine/state_machine.gd" id="3_nmpxg"]
[ext_resource type="Texture2D" uid="uid://dymfq5h55luqx" path="res://assets/railcarsprites.png" id="3_rsh2y"]
[ext_resource type="Script" uid="uid://cgxc1m8epbsvj" path="res://game/rollercoaster/states/stopped_state.gd" id="4_8bbrx"]
[ext_resource type="Script" uid="uid://bvpch57cprwa7" path="res://game/rollercoaster/states/moving_on_rails_state.gd" id="5_1ove5"]
[ext_resource type="Script" uid="uid://btuxrxldtn8mr" path="res://game/rollercoaster/states/jumping_state.gd" id="5_j853t"]
[ext_resource type="Script" uid="uid://hstyt5t0d27f" path="res://game/rollercoaster/states/falling_state.gd" id="6_hr1qv"]
[ext_resource type="Script" path="res://game/rollercoaster/player_controller.gd" id="6_pce4i"]
[ext_resource type="Script" uid="uid://d1pnsgn8hit3i" path="res://game/rollercoaster/states/station_state.gd" id="9_rsh2y"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0cxb7"]
shader = ExtResource("2_y8uoc")
shader_parameter/deformation = Vector2(0, 0)
shader_parameter/sidewaysDeformationFactor = 5.0
shader_parameter/knockbackFactor = 0.4

[sub_resource type="AtlasTexture" id="AtlasTexture_rsh2y"]
atlas = ExtResource("3_rsh2y")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_y8uoc"]
atlas = ExtResource("3_rsh2y")
region = Rect2(0, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_0cxb7"]
atlas = ExtResource("3_rsh2y")
region = Rect2(64, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_b70cr"]
atlas = ExtResource("3_rsh2y")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_yw4u4"]
atlas = ExtResource("3_rsh2y")
region = Rect2(0, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_wprvx"]
atlas = ExtResource("3_rsh2y")
region = Rect2(64, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_8v57q"]
atlas = ExtResource("3_rsh2y")
region = Rect2(64, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_p2xsc"]
atlas = ExtResource("3_rsh2y")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_wsxgt"]
atlas = ExtResource("3_rsh2y")
region = Rect2(64, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_33xk4"]
atlas = ExtResource("3_rsh2y")
region = Rect2(0, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_4i0yg"]
atlas = ExtResource("3_rsh2y")
region = Rect2(64, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_x10rd"]
atlas = ExtResource("3_rsh2y")
region = Rect2(0, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_t1pdu"]
atlas = ExtResource("3_rsh2y")
region = Rect2(64, 128, 64, 64)

[sub_resource type="SpriteFrames" id="SpriteFrames_fpfh7"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_rsh2y")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_y8uoc")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rsh2y")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_0cxb7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rsh2y")
}],
"loop": true,
"name": &"Barrel roll",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_b70cr")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_yw4u4")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wprvx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_8v57q")
}],
"loop": true,
"name": &"Flat spin",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_p2xsc")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wsxgt")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_33xk4")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4i0yg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_x10rd")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_t1pdu")
}],
"loop": true,
"name": &"default",
"speed": 5.0
}]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_nmpxg"]
size = Vector2(26, 26)

[sub_resource type="Curve2D" id="Curve2D_hr1qv"]
_data = {
"points": PackedVector2Array(0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 99, 101, -1, 0, 0, 0, 200, 100)
}
point_count = 3

[node name="Rollercoaster" type="CharacterBody2D" node_paths=PackedStringArray("state_machine", "animations", "path", "path_follow")]
collision_layer = 2
collision_mask = 5
slide_on_ceiling = false
floor_stop_on_slope = false
floor_block_on_wall = false
floor_max_angle = 3.14159
platform_on_leave = 2
platform_floor_layers = 4294967041
platform_wall_layers = 1
script = ExtResource("1_fpfh7")
state_machine = NodePath("StateMachine")
animations = NodePath("AnimatedSprite2D")
path = NodePath("AnimatePath")
path_follow = NodePath("AnimatePath/AnimatePathFollow")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
material = SubResource("ShaderMaterial_0cxb7")
sprite_frames = SubResource("SpriteFrames_fpfh7")
animation = &"Barrel roll"
offset = Vector2(0, -8)

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, -8)
shape = SubResource("RectangleShape2D_nmpxg")

[node name="StateMachine" type="Node2D" parent="." node_paths=PackedStringArray("starting_state")]
script = ExtResource("3_nmpxg")
starting_state = NodePath("FallingState")

[node name="MovingOnRailsState" type="Node2D" parent="StateMachine" node_paths=PackedStringArray("jumping_state", "falling_state", "stopped_state", "station_state")]
script = ExtResource("5_1ove5")
jumping_state = NodePath("../JumpingState")
falling_state = NodePath("../FallingState")
stopped_state = NodePath("../StoppedState")
station_state = NodePath("../StationState")

[node name="JumpingState" type="Node2D" parent="StateMachine" node_paths=PackedStringArray("moving_on_rails_state", "falling_state")]
script = ExtResource("5_j853t")
moving_on_rails_state = NodePath("../MovingOnRailsState")
falling_state = NodePath("../FallingState")

[node name="FallingState" type="Node2D" parent="StateMachine" node_paths=PackedStringArray("moving_on_rails_state", "stopped_state")]
script = ExtResource("6_hr1qv")
moving_on_rails_state = NodePath("../MovingOnRailsState")
stopped_state = NodePath("../StoppedState")

[node name="StoppedState" type="Node2D" parent="StateMachine"]
script = ExtResource("4_8bbrx")

[node name="StationState" type="Node2D" parent="StateMachine" node_paths=PackedStringArray("falling_state")]
script = ExtResource("9_rsh2y")
falling_state = NodePath("../FallingState")

[node name="PlayerController" type="Node2D" parent="."]
script = ExtResource("6_pce4i")

[node name="Camera2D" type="Camera2D" parent="."]
position_smoothing_enabled = true
position_smoothing_speed = 100.0

[node name="AnimatePath" type="Path2D" parent="."]
top_level = true
curve = SubResource("Curve2D_hr1qv")

[node name="AnimatePathFollow" type="PathFollow2D" parent="AnimatePath"]
position = Vector2(34.9969, 35.7039)
rotation = 0.795398
progress = 50.0
loop = false
